# 差分検出処理

React は２つの仮定に基づくことで、再レンダーの要否を判定するアルゴリズムを実装している。

1. 異なる型の２つの要素は異なるツリーを生成する
2. 開発者は key プロパティを与えることで、異なるレンダー間でどの子要素が変化しない可能性があるのかについてヒントを出すことができる

## 差分アルゴリズム

２つのツリーが異なっている場合、React は最初に２つのルート要素を比較する。

### 異なる型の要素

ルート要素が異なる型を持つ場合、React は常に古いツリーを破棄して新しいツリーをゼロから構築する。例えば`<a>`から`<img>`、`<Article>`から`<Comment>`、`<Button>`から`<div>`へルート要素を変更するとツリーが再構築される。

ツリーを破棄する時点で、古い DOM ノードも破棄される。破棄されるコンポーネントのインスタンスは`componentWillUnmount()`を受け取る。新しいツリーを構築する時点で、新しい DOM ノードが DOM に挿入される。新しいコンポーネントのインタスタンスは`UNSAFE_componentWillMount()` と`componentDidMount()`を受け取る。古いツリーに関連付けられたすべての`state`は失われる。

例えば以下のように、ルート要素が異なる型に更新されると、更新前の古い`Counter`コンポーネントは破棄される。そして、更新後の新しい`Counter`コンポーネントがマウントされる。

- 更新前

  ```js
  <div>
    <Counter />
  </div>
  ```

- 更新後

  ```js
  <span>
    <Counter />
  </span>
  ```
